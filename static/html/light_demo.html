<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <script src="../three/three.min.js"></script>
  <div id="world">
  </div>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    #world {
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(#e4e0ba, #f7d9aa)
    }

  </style>
  <script>
    var colors = {
      red: 0xf25346,
      white: 0xd9d0d1,
      brown: 0x59332e,
      pink: 0xF5986E,
      brownDark: 0x23190f,
      blue: 0x68c3c0
    }

    var scene,
      camera, fieldOfView, aspectRatio, nearPlane, farPlane, HEIGHT, WIDTH,
      renderer, container;

    function createScene() {
      HEIGHT = window.innerHeight;
      WIDTH = window.innerWidth;

      scene = new THREE.Scene();
      aspectRatio = WIDTH / HEIGHT;
      fieldOfView = 60;
      nearPlane = 1;
      farPlane = 10000;
      camera = new THREE.PerspectiveCamera(
        fieldOfView,
        aspectRatio,
        nearPlane,
        farPlane
      );
      scene.fog = new THREE.Fog(0xf7d9aa, 100, 950);
      camera.position.x = 0;
      camera.position.z = 200;
      camera.position.y = 100;

      renderer = new THREE.WebGLRenderer({
        alpha: true,
        antialias: true
      });
      renderer.setSize(WIDTH, HEIGHT);
      renderer.shadowMap.enabled = true;
      container = document.getElementById('world');
      container.appendChild(renderer.domElement);

      window.addEventListener('resize', handleWindowResize, false);
    }

    function handleWindowResize() {
      HEIGHT = window.innerHeight;
      WIDTH = window.innerWidth;
      renderer.setSize(WIDTH, HEIGHT);
      camera.aspect = WIDTH / HEIGHT;
      camera.updateProjectionMatrix();
    }

    var ambientLight, hemisphereLight, shadowLight;

    function createLights() {
      hemisphereLight = new THREE.HemisphereLight(0xaaaaaa, 0x000000, .9)
      shadowLight = new THREE.DirectionalLight(0xffffff, .9);
      shadowLight.position.set(150, 350, 350);
      shadowLight.castShadow = true;
      shadowLight.shadow.camera.left = -400;
      shadowLight.shadow.camera.right = 400;
      shadowLight.shadow.camera.top = 400;
      shadowLight.shadow.camera.bottom = -400;
      shadowLight.shadow.camera.near = 1;
      shadowLight.shadow.camera.far = 1000;
      shadowLight.shadow.mapSize.width = 2048;
      shadowLight.shadow.mapSize.height = 2048;

      scene.add(hemisphereLight);
      scene.add(shadowLight);
    }

    function Sea() {
      // // 通过合并顶点：确保海浪的连续性
      // geom.mergeVertices();

      // // 获得顶点
      // var l = geom.vertices.length;
      // // 创建一个新的数组 存储与每个顶点关联的值
      // this.waves = [];

      var geom = new THREE.CylinderGeometry(600, 600, 800, 40, 10);
      geom.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));
      var mat = new THREE.MeshPhongMaterial({
        color: colors.blue,
        transparent: true,
        opacity: .6,
        shading: THREE.FlatShading,
      });
      this.mesh = new THREE.Mesh(geom, mat);
      this.mesh.receiveShadow = true;
    }

    var sea;

    function createSea() {
      sea = new Sea();
      sea.mesh.position.y = -600;
      scene.add(sea.mesh);
    }

    function createSky() {
      sky = new Sky();
      sky.mesh.position.y = -600;
      scene.add(sky.mesh);
    }

    function Cloud() {
      this.mesh = new THREE.Object3D();
      this.mesh.name = "cloud";
      var geom = new THREE.CubeGeometry(20, 20, 20);
      var mat = new THREE.MeshPhongMaterial({
        color: colors.white,
      });

      var nBlocs = 3 + Math.floor(Math.random() * 3);
      for (var i = 0; i < nBlocs; i++) {
        var m = new THREE.Mesh(geom.clone(), mat);
        m.position.x = i * 15;
        m.position.y = Math.random() * 10;
        m.position.z = Math.random() * 10;
        m.rotation.z = Math.random() * Math.PI * 2;
        m.rotation.y = Math.random() * Math.PI * 2;
        var s = .1 + Math.random() * .9;
        m.scale.set(s, s, s);
        m.castShadow = true;
        m.receiveShadow = true;
        this.mesh.add(m);
      }
    }

    // 定义天空对象
    function Sky() {
      this.mesh = new THREE.Object3D();
      this.nClouds = 20;
      this.clouds = [];
      var stepAngle = Math.PI * 2 / this.nClouds;
      for (var i = 0; i < this.nClouds; i++) {
        var c = new Cloud();
        this.clouds.push(c);
        var a = stepAngle * i;
        var h = 750 + Math.random() * 200;
        c.mesh.position.y = Math.sin(a) * h;
        c.mesh.position.x = Math.cos(a) * h;
        c.mesh.position.z = -400 - Math.random() * 400;
        c.mesh.rotation.z = a + Math.PI / 2;
        var s = 1 + Math.random() * 2;
        c.mesh.scale.set(s, s, s);
        this.mesh.add(c.mesh);
      }
    }

    function init() {
      // 设置场景
      createScene();

      // 设置灯光
      createLights();

      // 设置对象
      // craetePlane();
      createSea();
      createSky();

      // 设置动画
      loop()
    }

    window.addEventListener('load', init, false);

    function loop() {
      // call the loop function again
      requestAnimationFrame(loop)
      sea.mesh.rotation.z += .005;
      sky.mesh.rotation.z += .01;
      // render the scene
      renderer.render(scene, camera);
    }

  </script>
</body>

</html>
