<template>
    <div class="screening-wrap">
      <div>筛选</div>
      <el-form  v-model="filterParams" class="demo-ruleForm" label-width="90px" :class="type!=1?'normal-from':'' ">
        <el-form-item label="选择对象：" prop="groupGuidName">
          <input class="group-name-input" type="text" v-model="filterParams.groupGuidName" @click="groupGuidNameClick" auto-complete="off"/>
          <span class="icon-select"></span>
        </el-form-item>
       <el-form-item label="维度：" prop="dimension" auto-complete="off">
         <template v-for="(ele,index ) in dimensionData">
           <button class="dimension-button" @click.stop.prevent="handleButton(index)" :key="index" :class="(filterParams.dimension-1) == index?'actived':''">{{ele}}</button>
         </template>
        </el-form-item>
        <el-form-item label="时间："  prop="startTime">
          <el-date-picker v-show="filterParams.dimension == 1" 
          type="date" 
           v-model="filterParams.startTime"
           placeholder="选择日期"
           value-format = "yyyy-MM-dd" 
           class="picker-data"
           :picker-options="pickerOptions1"
          >
          </el-date-picker> 
          <el-date-picker v-show ="filterParams.dimension > 1"
            v-model="filterParams.timeArray"
            type="daterange"
            align="right"
            unlink-panels
            range-separator="至"
            start-placeholder="开始日期"
            end-placeholder="结束日期"
            value-format = "yyyy-MM-dd"
            :picker-options="pickerOptions1"
            >
          </el-date-picker>
          <span class="icon-select"></span>
        </el-form-item>
        <el-form-item>
          <el-button class="affirm" @click.stop.prevent="submitForm()">提交</el-button>
        </el-form-item>
      </el-form>
      <!-- 选择社群 -->
     <ob-dialog-form
      @remote-submit="remoteSubmit"
      :type="dialogOptions.type"
      :title="dialogOptions.title"
      :visible.sync="dialogFormVisible">
    </ob-dialog-form>
    </div>
</template>

<script>
    import { mapGetters,mapMutations} from 'vuex'
    export default {
        name: "screening-index",
        props: ['type'],
        data() {
          let groupGuidNameFunction = (rule, value, callback) => {
              if(!value){
                  return callback(new Error("选择对象不能为空"));
              }
          }
          return {
             pickerOptions1: {   //不能选择当前时间之后的日期
                disabledDate(time) {
                  return time.getTime() > Date.now();
                }
            },
            rules: {
              groupGuidName: [
                { validator: groupGuidNameFunction, trigger: 'blur' }
              ],
            },
            dialogFormVisible: false,
            dialogOptions: {
              title: '添加社群',
              type: 'group'
            },
            dimensionData: ['小时','日','周','月'],
            filterParams: {
              groupGuid: '',     //选择社群 6867A6C096844AD4982F19323B6C9574 
              type: '',         //类型
              dimension: '',    //维度
              startTime: '',    //开始时间
              endTime:'',       //结束时间
              timeArray: [],
              groupGuidName: '',
            }
          }
        },
      methods: {
        //选择对象
        groupGuidNameClick() {
            this.dialogFormVisible = true;
        },
        //确定弹框
        remoteSubmit(data) {
          if((!data || data.length ==0)) {
             this.$alert('请选择对象', '提示:', {
              confirmButtonText: '确定',
              callback: action => {
              }
            });
            return;
          }
          this.dialogFormVisible = false;
          this.filterParams.groupGuidName = data[0].groupNickName;
          this.filterParams.groupGuid = data[0].groupGuid;
        },
        //点击维度
        handleButton(value) {
          this.filterParams.dimension = value+1;
        },
        //处理时间
        dealTime() {
          if(this.filterParams.timeArray.length != 0){
            let tempDate = this.filterParams.timeArray;
            this.filterParams.startTime = tempDate[0];
            this.filterParams.endTime = tempDate[1];
          }else {
            this.filterParams.endTime = this.filterParams.startTime;
          }
        },
        //vuex状态管理数据
        changeParams() {
          this.$store.commit("SET_FILTER_PARAMS",this.filterParams);
          //这这里触发兄弟组件更新条件
          this.$parent.$children[1].getData();
          this.$parent.$children[2].getData();
        },
        //查询
        submitForm() {
          if(this.filterParams.groupGuid == "") {
            this.$tip("选择对象不能为空！");
            return;
          }
          if(this.filterParams.dimension >1 && this.filterParams.timeArray.length == 0) {
            this.$tip("选择时间不能为空！");
            return;
          }
          this.dealTime();
          this.changeParams();
        }
      },
      created() {
      },
      mounted() {
          //默认值处理
          this.filterParams.startTime = this.$store.state.filterParams.startTime;
          this.filterParams.endTime = this.$store.state.filterParams.endTime;
          this.filterParams.timeArray = this.$store.state.filterParams.timeArray;
          this.filterParams.type = this.type;
          this.filterParams.groupGuidName = this.$store.state.filterParams.groupGuidName;
          this.filterParams.groupGuid = this.$store.state.filterParams.groupGuid;
          this.filterParams.dimension = this.$store.state.filterParams.dimension;
          this.$store.commit("SET_FILTER_PARAMS",this.filterParams);
          if((this.filterParams.groupGuid != "") && (!!this.filterParams.groupGuid)) {
            this.$parent.$children[1].getData();
            this.$parent.$children[2].getData();
          }
      },
      computed: {
      }
    }
</script>
<style  rel="stylesheet/scss" lang="scss">
     .demo-ruleForm {
       .el-form-item__label {
        color: #ffffff;
      }
      .el-range__icon,.el-input__icon {
        display: none;
      }
      .el-range-separator {
        line-height: 20px;
      }
      .el-range-editor--small.el-input__inner  {
        height: 28px ;
            line-height: 28px;
      }
       .picker-data  {
          input.el-input__inner {
              height: 28px ;
              line-height: 28px;
          }
          input {
            border: none;
            -webkit-background-size: 100% 100%;
            background-size: 100% 100%;
            background-color: #fff; 
            border: 1px solid;
            color: #000;
          }
      }
     }
</style>

<style rel="stylesheet/scss" lang="scss" scoped>
  .screening-wrap {
      height: 100%;
      box-sizing: border-box;
      padding: 20px;
      background: rgba(64,58,73,0.30);
      box-shadow: 0 0 4px 0 rgba(0,0,0,0.10);
    .demo-ruleForm {
      box-sizing: border-box;
      padding: 40px 14px;
      .el-form-item--small.el-form-item {
        margin-bottom: 10px;
      }
      .el-date-editor.el-input, .el-date-editor.el-input__inner {
        width: 210px;
      }
      .picker-data {
        .el-input--small .el-input__inner {
            height: 28px;
            line-height: 28px;
        }
      }
      .group-name-input {
           width: 210px;
            height: 26px !important;
            line-height: 28px;
            -webkit-border-radius: 3px;
            border-radius: 3px;
            text-indent: 26px;
            border: none;
            /* background: url(/static/img/input_border_bg.png) no-repeat center; */
            -webkit-background-size: 100% 100%;
            background-size: 100% 100%;
            /* background-color: transparent; */
            /* color: #fff;*/
      }
      .icon-select {
          display: inline-block;
          position: absolute;
          &::after {
              content: "";
              width: 0px;
              height: 0px;
              border-right: 6px solid transparent;
              border-left: 6px solid transparent;
              border-top: 6px solid rgba(0,0,0,0.6);
              top: 14px;
              left: -28px;
              cursor: pointer;
              position: relative;
        }
      }
      .dimension-button {
        width: 48px;
        height: 28px;
        background: transparent;
        border: 1px solid #ffffff;
        color: #ffffff;
        border-radius: 3px;
        font-size: 12px;
        margin-right: 6px;
      }
      .actived {
        color: #2187DF;
        border: 1px solid #2187DF;
        box-shadow: 0 2px 4px 0 rgba(22,20,24,0.50);
      }
    }
    .normal-from {
         padding: 14px !important;
   }
  }
</style>
